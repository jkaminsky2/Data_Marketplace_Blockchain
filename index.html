<!-- 
  Website Repo: https://github.com/suaye07/DSC180_proj_web.git
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Upload</title>
</head>
<body>
    <form id="csvUploadForm" enctype="multipart/form-data">
        <input type="file" id="csvFile" accept=".csv" />
        <button type="submit">Upload the CSV</button>
    </form>

    <!-- Loading message -->
    <p id="loadingMessage" style="display: none;">Loading...</p>

    <script>
        document.getElementById('csvUploadForm').addEventListener('submit', async (event) => {
    event.preventDefault();

    const fileInput = document.getElementById('csvFile');
    const loadingMessage = document.getElementById('loadingMessage');
    const statusMessage = document.createElement('p');
    document.body.appendChild(statusMessage);  // To show the status message
    const file = fileInput.files[0];

    if (file) {
        // Validate file type
        const fileExtension = file.name.split('.').pop();
        if (fileExtension !== 'csv') {
            statusMessage.innerText = 'Please upload a CSV file.';
            return;
        }

        // Show the loading message
        loadingMessage.style.display = 'block';
        statusMessage.innerText = 'Uploading...';

        const formData = new FormData();
        formData.append('file', file);

        try {
            const response = await fetch('https://629dvfww9a.execute-api.us-east-2.amazonaws.com/dev', {
                mode: 'cors',
                credentials: 'include',
                method: 'POST',
                body: formData,
            });

            const responseText = await response.text();
            if (response.ok) {
                statusMessage.innerText = 'File uploaded successfully!';
            } else {
                statusMessage.innerText = 'File upload failed: ' + responseText;
            }
        } catch (error) {
            statusMessage.innerText = 'An error occurred: ' + error.message;
        } finally {
            // Hide the loading message after completion
            loadingMessage.style.display = 'none';
        }
    } else {
        statusMessage.innerText = 'No file selected';
    }
});
    </script>
</body>
</html>
